---
layout: post
title: ç®—æœ¯é¢˜ç”Ÿæˆå™¨
tags:
  - ç®—æœ¯è¿ç®—
  - å­—ç¬¦ä¸²å¤„ç†
categories:
  - æŠ€æœ¯
  - Python
description: >-
  æœ€è¿‘å­¦æ ¡å¸ƒç½®äº†ä¸€ä¸ªä½œä¸šâ€œä¸­å°å­¦æ•°å­¦è¯•å·è‡ªåŠ¨ç”Ÿæˆç¨‹åºâ€ï¼Œä»¥å‰æˆ‘è‡ªå·±ä¹Ÿåšè¿‡è®¡ç®—æ•°å­¦è¡¨è¾¾å¼çš„ç¨‹åºï¼Œç”¨è¿‡æ¨¡æ‹Ÿäººè„‘çš„æ–¹æ³•ï¼Œä¹Ÿå­¦ä¹ äº†ä½¿ç”¨åç¼€è¡¨è¾¾å¼æ¥å¤„ç†çš„æ–¹æ³•ï¼Œè¿™æ¬¡åˆç¢°åˆ°äº†ç±»ä¼¼çš„é¢˜ç›®ï¼Œäºæ˜¯å†™ä¸‹è¿™ç¯‡åšå®¢ï¼Œè®°å½•è‡ªå·±äº†è§£çš„å¤„ç†è¡¨è¾¾å¼çš„æ–¹æ³•...
abbrlink: e18e1106
date: 2020-09-26 19:27:22
---

## åç¼€è¡¨è¾¾å¼

ä¸­ç¼€è¡¨è¾¾å¼æ˜¯å°†è¿ç®—ç¬¦æ”¾åœ¨æ“ä½œæ•°ä¸­é—´ï¼Œè€Œåç¼€è¡¨è¾¾å¼åˆ™æ˜¯å°†è¿ç®—ç¬¦æ”¾åœ¨æ“ä½œæ•°åé¢ï¼ŒåŒæ—¶ä¹Ÿä¸éœ€è¦æ‹¬å·ï¼Œç›´æ¥ä¸Šä¸ªä¾‹å­ï¼š

| ä¸­ç¼€è¡¨è¾¾å¼        | åç¼€è¡¨è¾¾å¼    |
| ----------------- | ------------- |
| `(a+b)*c-(d+e)/f` | `ab+c*de+f/-` |

ä½ ä¼šå‘ç°æ²¡æœ‰æ‹¬å·çš„åç¼€è¡¨è¾¾å¼éå¸¸é€‚åˆè®¡ç®—æœºæ¥å¤„ç†ï¼š

1. å‡†å¤‡ä¸€ä¸ªæ ˆ
2. ä»å·¦è‡³å³éå†è¡¨è¾¾å¼
   - éå†æ—¶é‡åˆ°æ“ä½œæ•°åˆ™å…¥æ ˆ
   - éå†æ—¶è¿ç®—ç¬¦åˆ™å‡ºæ ˆä¸€å®šæ•°é‡çš„æ“ä½œæ•°ï¼Œå°†è¿ç®—ç»“æœå…¥æ ˆ
3. å½“è¡¨è¾¾å¼éå†å®Œæˆï¼Œæ ˆä¸­åº”å½“åªæœ‰ä¸€ä¸ªæ•°ï¼Œå³ä¸ºè¡¨è¾¾å¼ç»“æœ

æ—¢ç„¶åç¼€è¡¨è¾¾å¼è¿™ä¹ˆå¥½ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„é—®é¢˜å°±åœ¨äºå¦‚ä½•å°†ä¸­ç¼€è¡¨è¾¾å¼ç®€ç®€æ´é«˜æ•ˆåœ°è½¬æ¢æˆåç¼€è¡¨è¾¾å¼ï¼Œå¦‚æœå’Œæ¨¡æ‹Ÿæ³•ä¸€æ ·å¤æ‚ï¼Œé‚£ä¹ˆåç¼€è¡¨è¾¾å¼å°±æ²¡æœ‰æ„ä¹‰ã€‚

### åŸºäºæ ˆ

ä¸­ç¼€è¡¨è¾¾å¼çš„å¤æ‚ä¹‹å¤„åœ¨äºå…¶æ‹¬å·ï¼Œè¦åŒ¹é…æ‹¬å·æœ€é«˜æ•ˆåœ°åŠæ³•å°±æ˜¯åˆ©ç”¨æ ˆï¼Œåœ¨è¿™ä¹‹ä¸Šæ”¹è¿›å°±å¯ä»¥è½¬æ¢æˆåç¼€è¡¨è¾¾å¼ã€‚

ä»å·¦è‡³å³éå†è¡¨è¾¾å¼ï¼š

1. é‡åˆ°æ“ä½œæ•°ç›´æ¥è¾“å‡º
2. é‡åˆ°è¿ç®—ç¬¦åˆ™åˆ†ä¸ºä»¥ä¸‹æƒ…å†µï¼š
   1. æ ˆä¸ºç©ºï¼šè¯¥è¿ç®—ç¬¦ç›´æ¥å…¥æ ˆ
   2. æ ˆé¡¶ä¸ºå·¦æ‹¬å·ï¼šè¯¥è¿ç®—ç¬¦ç›´æ¥å…¥æ ˆ
   3. æ ˆé¡¶è¿ç®—ç¬¦ä¼˜å…ˆçº§è¾ƒä½ï¼šè¯¥è¿ç®—ç¬¦ç›´æ¥å…¥æ ˆ
   4. æ ˆé¡¶è¿ç®—ç¬¦ä¼˜å…ˆçº§è¾ƒé«˜æˆ–ç›¸ç­‰ï¼šå‡ºæ ˆå¹¶è¾“å‡ºï¼Œå†æ¬¡æ¯”è¾ƒè¯¥è¿ç®—ç¬¦ä¸æ ˆé¡¶è¿ç®—ç¬¦
3. é‡åˆ°å·¦æ‹¬å·åˆ™ç›´æ¥å…¥æ ˆ
4. é‡åˆ°å³æ‹¬å·åˆ™ä¾æ¬¡å‡ºæ ˆå¹¶è¾“å‡ºï¼Œç›´è‡³é‡åˆ°å·¦æ‹¬å·ï¼Œå°†å·¦æ‹¬å·å‡ºæ ˆï¼Œä¸å³æ‹¬å·ä¸€åŒ**èˆå¼ƒ**
5. éå†å®Œæˆï¼Œå‡ºæ ˆå¹¶è¾“å‡ºæ‰€æœ‰è¿ç®—ç¬¦

å½“ç„¶ä¸Šè¿°åªé™äºäºŒå…ƒè¿ç®—ç¬¦ï¼Œå¦‚æœæœ‰ä¸€å…ƒè¿ç®—ç¬¦åˆ™éœ€è¦åšå‡ºä¸€å®šæ”¹åŠ¨ï¼Œä½†æ˜¯å¹¶ä¸å½±å“æ•´ä½“ç»“æ„ã€‚

åŒæ—¶ï¼Œä»¥ä¸Šè¾“å‡ºè¿ç®—ç¬¦æ—¶å…¶å®å¯ä»¥ç›´æ¥è¿›è¡Œè®¡ç®—ï¼Œæ²¡å¿…è¦ç­‰è¡¨è¾¾å¼å¤„ç†å®Œæ¯•å†ä»å¤´éå†å¼€å§‹è®¡ç®—ï¼Œè¾“å‡ºæ—¶ç›´æ¥å‹å…¥å¦ä¸€ä¸ªæ ˆå°±å¥½ã€‚

### æ‹¬å·æ³•

ä¸Šé¢è¯´åˆ°ä¸­ç¼€è¡¨è¾¾å¼çš„å¤æ‚ä¹‹å¤„åœ¨äºå…¶æ‹¬å·ï¼Œè¿ç®—ç¬¦æœ‰ä¼˜å…ˆçº§å†åŠ ä¸Šæ‹¬å·æ”¹å˜ä¼˜å…ˆçº§æ‰æ˜¯å…¶å¤æ‚çš„åŸå› ï¼Œå¦‚æœæˆ‘ä»¬è®©ä¼˜å…ˆçº§åªæœ‰ä¸€å¥—è§„åˆ™ï¼Œæ²¡æœ‰ç‰¹æƒå°±ä¼šç®€å•è®¸å¤šï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥åœ¨ä¸æ”¹å˜è¡¨è¾¾å¼è¿ç®—ä¼˜å…ˆçº§çš„æƒ…å†µä¸‹ï¼Œåœ¨æ‰€æœ‰å­è¡¨è¾¾å¼å¤–éƒ½åŠ ä¸Šæ‹¬å·ï¼Œå°±å¯ä»¥å¾ˆè½»æ¾åœ°è½¬æ¢æˆåç¼€è¡¨è¾¾å¼ã€‚

è¿˜æ˜¯ä»¥ `(a+b)*c-(d+e)/f` ä¸ºä¾‹ï¼š

1. åŠ æ‹¬å·å˜æˆï¼š`(((a+b)*c)-((d+e)/f))`
2. å°†è¿ç®—ç¬¦ç§»åŠ¨è‡³å½“å‰å­è¡¨è¾¾å¼çš„æ‹¬å·å³ä¾§ï¼š`(((ab)+c)*((de)+f)/)-`
3. å»æ‰æ‰€æœ‰æ‹¬å·ï¼š`ab+c*de+f/-`

æ‹¬å·æ³•å¤æ‚çš„ç‚¹åœ¨åŠ æ‹¬å·ä¸Šï¼Œåé¢ä¸¤æ­¥åŠ èµ·æ¥åªè¦ä¸€ä¸ªéå†å°±èƒ½å®Œæˆï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰å®ç°è¿‡ï¼Œæ•…ä¸ä½œè¯„è®ºã€‚

### è¯­æ³•æ ‘

ä¸å¾—ä¸è¯´æ ‘åœ¨å“ªé‡Œéƒ½èƒ½æ’ä¸Šä¸€æ‰‹ã€‚æˆ‘ä»¬æŒ‰ç…§ä»¥ä¸‹è§„åˆ™æ„å»ºä¸€æ£µäºŒå‰æ ‘ï¼š

1. å¶å­èŠ‚ç‚¹éƒ½æ˜¯æ“ä½œæ•°
2. éå¶å­èŠ‚ç‚¹éƒ½æ˜¯è¿ç®—ç¬¦
3. æ ¹èŠ‚ç‚¹çš„ä¼˜å…ˆçº§ä½äºå­èŠ‚ç‚¹

å¦‚æœæ„å»ºå‡ºè¯¥æ ‘ï¼Œåˆ™é€šè¿‡å…ˆåº/ä¸­åº/ååºéå†ï¼Œæˆ‘ä»¬åˆ†åˆ«å¯ä»¥å¾—åˆ°å‰ç¼€/ä¸­ç¼€/åç¼€è¡¨è¾¾å¼ï¼ˆäºŒå‰æ ‘ğŸ®ğŸºï¼‰ã€‚

ä»ä¸­ç¼€è¡¨è¾¾å¼æ„å»ºæ ‘å¯èƒ½ä¼šæ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºéœ€è¦ç»Ÿè®¡æ‰€æœ‰è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ï¼ˆæ‹¬å·ä¼šæ”¹å˜ä¼˜å…ˆçº§ï¼‰ï¼Œä»ä¼˜å…ˆçº§æœ€ä½çš„è¿ç®—ç¬¦å¼€å§‹æ‹†è§£è¡¨è¾¾å¼ï¼Œé€’å½’å¤„ç†ã€‚æœ¬äººæ²¡æœ‰å®ç°è¿‡ï¼Œä¹Ÿå°±ä¸å¦„ä½œè¯„è®ºäº†ã€‚

## ç”Ÿæˆè¡¨è¾¾å¼

çºµè§‚ä¸Šè¿°ä¸­ç¼€è¡¨è¾¾å¼è½¬åç¼€è¡¨è¾¾å¼çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å‘ç°å¦‚æœæœ‰ä¸€ä¸ªåç¼€è¡¨è¾¾å¼ï¼Œæˆ–è€…ä¸€æ£µè¯­æ³•æ ‘ï¼Œé‚£ä¹ˆå°±èƒ½éå¸¸è½»æ¾åœ°å¾—åˆ°ä¸­ç¼€è¡¨è¾¾å¼ã€‚

### åŸºäºæ ˆ

é¦–å…ˆéšæœºç”Ÿæˆä¸€å®šæ•°é‡çš„æ“ä½œæ•°å’ŒäºŒå…ƒè¿ç®—ç¬¦ï¼Œä¿è¯äºŒå…ƒè¿ç®—ç¬¦æ•°é‡ç­‰äºæ“ä½œæ•°æ•°é‡å‡ä¸€ã€‚åŸå› å¾ˆç®€å•ï¼šæˆ‘ä»¬æœ€åè¦çš„è¡¨è¾¾å¼èƒ½è®¡ç®—æˆä¸€ä¸ªæ•°ï¼Œè®¾ä¸€ä¸ªæ•°åœ°æƒé‡ä¸º `1`ï¼Œé‚£ä¹ˆè¡¨è¾¾å¼åœ°æ€»æƒé‡åº”å½“ä¸º `1`ã€‚äºŒå…ƒè¿ç®—ç¬¦ä¼šå°†ä¸¤ä¸ªæ•°å˜æˆä¸€ä¸ªæ•°ï¼Œæƒé‡å°±æ˜¯ `-1`ã€‚ç®€å•è¿ç®—å°±èƒ½å¾—åˆ°ä¸¤è€…ä¹‹é—´çš„æ•°é‡å…³ç³»ã€‚

æ¥ä¸‹æ¥éœ€è¦å°†æ“ä½œæ•°ä¸è¿ç®—ç¬¦ç»„åˆèµ·æ¥ï¼ŒåŒæ ·ä½¿ç”¨ä¸Šè¿°çš„æƒé‡è®¡ç®—ã€‚æˆ‘ä»¬çŸ¥é“åç¼€è¡¨è¾¾å¼ä»å·¦åªæœ‰è®¡ç®—ï¼Œå¹¶ä¸”å§‹ç»ˆæœ‰è‡³å°‘ä¸€ä¸ªæ“ä½œæ•°ï¼Œå³ä»åç¼€è¡¨è¾¾å¼çš„æœ€å·¦ä¾§æˆªå–è‡³ä»»æ„ä½ç½®ï¼Œè¿™ä¸ªå­è¡¨è¾¾å¼çš„æƒé‡ä¸èƒ½å°äº `1`ã€‚æ‰€ä»¥æˆ‘ä»¬éå†å¯ä»¥æ’å…¥è¿ç®—ç¬¦çš„ä½ç½®ï¼Œä¿è¯æ€»æƒé‡ä¸å°äº `1`ï¼Œæ¯è¿­ä»£ä¸€ä¸ªæ“ä½œæ•°åˆ™æ€»æƒé‡åŠ  `1`ï¼Œæ·»åŠ ä¸€ä¸ªè¿ç®—ç¬¦åˆ™æƒé‡å‡ `1`ï¼Œåˆ°æœ€åæ—¶å°†å‰©ä¸‹çš„è¿ç®—ç¬¦éƒ½æ’å…¥å³å¯ã€‚

ä¸€å…ƒè¿ç®—ç¬¦çš„æƒé‡ä¸º `0`ï¼Œæ‰€ä»¥å¯ä»¥ä»»æ„æ·»åŠ ï¼Œåªè¦ä¸æ·»åŠ åœ¨æœ€å·¦ä¾§å³å¯ã€‚

åç¼€è¡¨è¾¾å¼ç”Ÿæˆå®Œæˆä¹‹åï¼Œåˆ™éœ€è¦è½¬æ¢æˆä¸­ç¼€è¡¨è¾¾å¼ï¼Œé¦–å…ˆå‡†å¤‡ä¸€ä¸ªæ ˆï¼ˆå­˜æ”¾ `(æ“ä½œæ•°/è¡¨è¾¾å¼, ä¼˜å…ˆçº§)`ï¼‰ï¼Œç„¶åéå†åç¼€è¡¨è¾¾å¼ï¼š

1. é‡åˆ°æ“ä½œæ•°åˆ™å…¥æ ˆ
2. é‡åˆ°è¿ç®—ç¬¦åˆ™å‡ºæ ˆä¸€å®šæ•°é‡æ“ä½œæ•°æˆ–è¡¨è¾¾å¼ï¼Œæ ¹æ®ä¼˜å…ˆçº§ç»™éœ€è¦çš„è¡¨è¾¾å¼åŠ ä¸Šæ‹¬å·ï¼Œç„¶åæ‹¼æ¥æˆè¡¨è¾¾å¼ï¼Œå…¥æ ˆ

å½“éå†å®Œæˆæ—¶ï¼Œæ ˆä¸­åº”å½“åªæœ‰ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå³ä¸ºç»“æœã€‚

å¦‚æœéœ€è¦åŒæ­¥è®¡ç®—å‡ºç»“æœï¼Œæ ˆä¸­å­˜æ”¾çš„å…ƒç´ åº”å½“ä¸º `(æ“ä½œæ•°/è¡¨è¾¾å¼, ä¼˜å…ˆçº§, å€¼)`ã€‚

ä¸Šæ®µä»£ç ï¼š

```python
def generate(level):
    """
    æ ¹æ® level ç”ŸæˆæŒ‡å®šç­‰çº§çš„ç®—æœ¯é¢˜
    0ï¼šå°å­¦ï¼›1ï¼šåˆä¸­ï¼›2ï¼šé«˜ä¸­
    """

    """
    ç”Ÿæˆæ“ä½œæ•°åºåˆ—ä»¥åŠäºŒå…ƒè¿ç®—ç¬¦åºåˆ—
    """
    length = randint(0 if level else 1, 4)
    op2Arr = [Generator.opset[randint(0, 3)] for i in range(length)]
    numArr = [randint(1, 100) for i in range(length + 1)]

    """
    ç”ŸæˆäºŒå…ƒè¿ç®—ç¬¦çš„ä½ç½®
    """
    remain = 1
    position = []
    for i in range(length):
        position.append(randint(0, remain))
        remain += 1 - position[i]
    if remain > 1:
        position[-1] += remain - 1

    """
    ç”Ÿæˆä¸€å…ƒè¿ç®—ç¬¦åºåˆ—
    """
    op1Arr = []
    if level:
        if level == 1:
            op1Arr.append(Generator.opset[randint(4, 5)])
        elif level == 2:
            op1Arr.append(Generator.opset[randint(6, 8)])
        for i in range(randint(0, level)):
            op1Arr.append(
                Generator.opset[randint(4, 5 if level == 1 else 8)])
        shuffle(op1Arr)

    """
    ç”Ÿæˆåç¼€è¡¨è¾¾å¼
    """
    expression = numArr
    offset = 2
    index = 0
    for i in range(length):
        for j in range(position[i]):
            expression.insert(i + j + offset, op2Arr[index])
            index += 1
        offset += position[i]
    for op in op1Arr:
        expression.insert(randint(1, len(expression)), op)

    def getPriority(item):
        """
        è¿”å›è¿ç®—ç¬¦æˆ–æ“ä½œæ•°çš„ä¼˜å…ˆçº§
        æ“ä½œæ•°ï¼š0
        ä¸€å…ƒè¿ç®—ç¬¦ï¼š1
        '*'ã€'/'ï¼š2
        '+'ã€'-'ï¼š3
        """
        if isinstance(item, int):
            return 0
        elif item == '+' or item == '-':
            return 3
        elif item == '*' or item == '/':
            return 2
        else:
            return 1

    """
    è½¬æ¢æˆä¸­ç¼€è¡¨è¾¾å¼
    stack å­˜å‚¨ (expression, priority)
    """
    stack = []
    for e in expression:
        priority = getPriority(e)
        if priority == 0:
            """
            æ˜¯ä¸€ä¸ªæ“ä½œæ•°ï¼Œç›´æ¥å…¥æ ˆ
            """
            stack.append((e, 0))
        elif priority == 3:
            """
            æ˜¯åŠ /å‡è¿ç®—ï¼Œä¼˜å…ˆçº§æœ€ä½ï¼Œæ‹¼æ¥åç›´æ¥å…¥æ ˆ
            """
            item2 = stack.pop()[0]
            item1 = stack.pop()[0]
            stack.append(('%s%s%s' % (item1, e, item2), 3))
        elif priority == 2:
            """
            æ˜¯ä¹˜/é™¤è¿ç®—ï¼Œå¦‚æœæœ‰åŠ /å‡è¿ç®—éœ€è¦åŠ æ‹¬å·
            """
            item2, prio2 = stack.pop()
            if prio2 > 2:
                item2 = '(%s)' % item2
            item1, prio1 = stack.pop()
            if prio1 > 2:
                item1 = '(%s)' % item1
            stack.append(('%s%s%s' % (item1, e, item2), 2))
        elif priority == 1:
            """
            æ˜¯ä¸€å…ƒè¿ç®—ï¼Œé™¤äº†æ“ä½œæ•°éƒ½è¦åŠ æ‹¬å·
            """
            item, prio = stack.pop()
            if prio:
                item = '(%s)' % item
            if e == 'Â²':
                stack.append(('%s%s' % (item, 'Â²'), 1))
            else:
                stack.append(('%s%s' % (e, item), 1))

    return stack[0][0]
```

### è¯­æ³•æ ‘

è¿™ç§æ–¹æ³•æˆ‘æ²¡æœ‰å®ç°ï¼Œä½†æ˜¯æˆ‘å¯ä»¥ç›´æ¥ç»™å‡ºèŠ‚ç‚¹çš„æ•°æ®ç»“æ„ï¼š

```java
class Node {
    String expression;  // è¡¨è¾¾å¼
    Double value;       // å€¼
    int priority;       // ä¼˜å…ˆçº§
    Node left;          // å·¦å­èŠ‚ç‚¹
    Node right;         // å³å­èŠ‚ç‚¹
}
```

æ ¹æ®è§„åˆ™ç”Ÿæˆä¸€æ£µåˆæ³•çš„æ ‘ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªåˆæ³•çš„è¡¨è¾¾å¼ï¼š

1. å¶å­èŠ‚ç‚¹éƒ½æ˜¯æ“ä½œæ•°
2. éå¶å­èŠ‚ç‚¹éƒ½æ˜¯è¿ç®—ç¬¦
3. æ ¹èŠ‚ç‚¹çš„ä¼˜å…ˆçº§ä½äºå­èŠ‚ç‚¹